@page "/newgame"

@inject Services.INewGame new_game;
@inject Services.ISettingsLoader sl;
@inject Services.IPassword pw;
@inject Services.IActivePlayer active;
@inject NavigationManager navigationManager;

<EditForm Model="@model" OnValidSubmit="New">
    <DataAnnotationsValidator/><ValidationSummary/>
    <label>Úroková míra:<br/><InputNumber @bind-Value="model.Interest"/><br/></label>
    <label>Pravděpodobnost odtržení prázdné provincie:<br/><InputNumber @bind-Value="model.DefaultInstability"/><br/></label>
    <label>Výchozí peníze:<br/><InputNumber @bind-Value="model.DefaultMoney"/><br/></label>
    <label>Omezení dluhu:<br/><InputNumber @bind-Value="model.DebtLimit"/><br/></label>
    <label>Automatické přepínání hráčů u jednoho počítače:<InputCheckbox @bind-Value="model.SingleClient"/><br/></label>
    <label>Staré heslo:<br/><InputText type="password" @bind-Value="model.OldPassword"/><br/></label>
    <label>Nové heslo:<br/><InputText type="password" @bind-Value="model.NewPassword"/><br/></label>
    <button type="submit">Vytvořit</button>
</EditForm>

@code{
    Models.NewGame model = new Models.NewGame();
    protected override void OnInitialized()
    {
        model.Interest = sl.Settings.Interest;
        model.DefaultInstability = sl.Settings.DefaultInstability;
        model.DefaultMoney = (int)sl.Settings.DefaultMoney;
        model.DebtLimit = (int)sl.Settings.DebtLimit;
        model.SingleClient = sl.Settings.SingleClient;
    }
    void New()
    {
        if (model.NewPassword != null && model.OldPassword != null && pw.IsCorrect(model.OldPassword))
        {
            new_game.New(model.Interest, (uint)model.DefaultMoney, (uint)model.DebtLimit, model.DefaultInstability, model.SingleClient);
            pw.Set(model.NewPassword);
            navigationManager.NavigateTo("/");
        }
        else
        {
            model.OldPassword = model.NewPassword = "";
        }
    }
}